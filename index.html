<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wedding Guest Clipboard Helper</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
  <div class="max-w-5xl mx-auto p-4 sm:p-6">
    <header class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3 mb-6">
      <div>
        <h1 class="text-2xl font-semibold">Guest List Clipboard Helper</h1>
        <p class="text-sm text-gray-600">Auto-loads <code>guest_rows.csv</code>. One-click copy for invitation links & messages.</p>
      </div>
      <div class="flex items-center gap-2">
        <input id="searchInput" type="search" placeholder="Search name, ID, relation‚Ä¶" class="w-64 max-w-full px-3 py-2 border rounded-xl bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-300" />
        <span id="countChip" class="chip bg-gray-100 text-xs px-2 py-0.5 rounded-full">0 guests</span>
      </div>
    </header>

    <section class="mb-4">
      <div class="bg-white border rounded-2xl p-4 shadow-sm text-sm text-gray-700">
        <div class="flex flex-wrap gap-x-6 gap-y-2">
          <div>Base URL: <code id="cfgBaseUrl"></code></div>
          <div>Due date: <code id="cfgDue"></code></div>
          <div>CSV file: <code class="mono">guest_rows.csv</code></div>
        </div>
        <p class="text-xs text-gray-500 mt-1">Push a new <code>guest_rows.csv</code> to the repo to update the list.</p>
      </div>
    </section>

    <section>
      <div class="bg-white border rounded-2xl shadow-sm overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-100">
            <tr class="text-left">
              <th class="px-3 py-2 font-medium">ID</th>
              <th class="px-3 py-2 font-medium">Name</th>
              <th class="px-3 py-2 font-medium">Type</th>
              <th class="px-3 py-2 font-medium">Relation</th>
              <th class="px-3 py-2 font-medium">Link</th>
              <th class="px-3 py-2 font-medium">Actions</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <p class="text-xs text-gray-500 mt-2">Tip: Press <kbd>Ctrl</kbd>/<kbd>Cmd</kbd>+<kbd>K</kbd> to focus search.</p>
    </section>
  </div>

  <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-4 px-3 py-2 rounded-xl bg-black/80 text-white text-sm shadow-lg opacity-0 pointer-events-none transition">Copied!</div>

  <script>
    const BASE_URL = 'https://www.alfoncindy.site';
    const DUE = '7th September 2025';
    const CSV_PATH = 'guest_rows.csv';

    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('cfgBaseUrl').textContent = BASE_URL;
      document.getElementById('cfgDue').textContent = DUE;
    });

    const RELATION_MAP = {
      'alfon_parent_relation': "Alfon's Parent",
      'cindy_parent_relation': "Cindy's Parent",
      'alfon_relation': 'Alfon',
      'cindy_relation': 'Cindy'
    };

    const TYPE_MAP = {
      'reception': 'Reception',
      'holy_matrimony': 'Holy Matrimony'
    };

    const $ = sel => document.querySelector(sel);
    const tbody = $('#tbody');
    const searchInput = $('#searchInput');
    const countChip = $('#countChip');

    function formatRelation(r) {
      return RELATION_MAP[r] || (r ? r.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase()) : '');
    }
    function formatType(t) {
      return TYPE_MAP[t] || (t ? t.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase()) : '');
    }

    function buildLink(g) {
      return `${BASE_URL}/${encodeURIComponent(g.id)}`;
    }

    function showToast(msg) {
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.classList.remove('opacity-0');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => el.classList.add('opacity-0'), 1400);
    }

    function renderRows(list) {
      tbody.innerHTML = '';
      list.forEach((g) => {
        const tr = document.createElement('tr');
        tr.className = 'border-t align-top';
        const link = buildLink(g);
        const waText = buildMessage(g);
        const nameCellMobileLink = `<div class="md:hidden mt-2"><a href="${link}" target="_blank" class="text-blue-600 underline break-all">Open link</a></div>`;
        tr.innerHTML = `
          <td class="px-3 py-2 mono align-top">${g.id ?? ''}</td>
          <td class="px-3 py-2 align-top">${g.name ?? ''}${nameCellMobileLink}</td>
          <td class="px-3 py-2 align-top">${g.invitation_type ?? ''}</td>
          <td class="px-3 py-2 align-top">${g.relation ?? ''}</td>
          <td class="px-3 py-2 hidden md:table-cell align-top"><a href="${link}" target="_blank" class="text-blue-600 underline break-all">${link}</a></td>
          <td class="px-3 py-2 align-top w-48">
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 w-full">
              <button class="bg-blue-600 hover:bg-blue-700 active:scale-95 text-white text-sm font-medium px-3 py-1.5 rounded-lg shadow w-full sm:w-auto" data-action="copy-link">Copy Link</button>
              <button class="bg-blue-600 hover:bg-blue-700 active:scale-95 text-white text-sm font-medium px-3 py-1.5 rounded-lg shadow w-full sm:w-auto" data-action="copy-wa">Copy Invitation Message</button>
            </div>
          </td>`;
        tbody.appendChild(tr);
        const [copyLinkBtn, copyWABtn] = tr.querySelectorAll('button');
        copyLinkBtn.addEventListener('click', () => { navigator.clipboard.writeText(link).then(()=>showToast('Link copied')); });
        copyWABtn.addEventListener('click', () => { navigator.clipboard.writeText(waText).then(()=>showToast('Message copied')); });
      });
      countChip.textContent = `${list.length} guest${list.length !== 1 ? 's' : ''}`;
    });
        });
      });
      countChip.textContent = `${list.length} guest${list.length !== 1 ? 's' : ''}`;
    }

    function applySearch(all) {
      const q = searchInput.value.trim().toLowerCase();
      const filtered = !q ? all : all.filter(g =>
        String(g.id).toLowerCase().includes(q) ||
        (g.name||'').toLowerCase().includes(q) ||
        (g.invitation_type||'').toLowerCase().includes(q) ||
        (g.relation||'').toLowerCase().includes(q)
      );
      renderRows(filtered);
    }

    fetch(`${CSV_PATH}?v=${Date.now()}`, { cache: 'no-cache' })
      .then(res => res.text())
      .then(text => {
        const parsed = Papa.parse(text, { header:true, skipEmptyLines:true, transformHeader: h => h.replace(/\ufeff/g,'') });
        const rows = parsed.data || [];
        const guests = rows.map(r => ({
          id: r.id,
          name: r.name,
          invitation_type: r.invitation_type,
          relation: r.relation,
          message: buildMessage(r)
        })).filter(g => g.id && g.name);
        window.ALL = guests;
        applySearch(guests);
      });

    searchInput.addEventListener('input', ()=>applySearch(window.ALL || []));

    function buildMessage(g) {
      const url = buildLink(g);
      const name = g.name;
      const type = g.invitation_type;
      let msg = '';
      if(type==='holy_matrimony'){
        msg = `Dear ${name},\n\nWith hearts full of gratitude, we joyfully share the blessing that our beloved son\n\nVincentius Alfon Lavinski\nSon of Mr. Rudy Susanto Sudjono & Mrs. Yosefin Paulina Sim,\n\nwill soon unite in holy matrimony with\n\nEugenia Abigail Cindy Citrasari\nDaughter of Mr. Niketius Hony Surjono & Mrs. Auxillia Monika Pariva,\n\nüìÖ Saturday, 27 September 2025\nüïï 12:00 WIB\nüìç Gereja St. Andreas Kim Tae-gon, Kelapa Gading, Jakarta Utara\n\nIt would mean the world to us if you could join in this moment of joy,\nto witness their vows and shower them with your prayers.\n\nKindly confirm your attendance through the link below before ${DUE}\n${url}\n\nYour presence is not only an honor, but also a precious gift to our family.\n\nWith love and gratitude,\n${regardsFor(g.relation, type)}`;
      } else {
        msg = `Dear ${name},\n\nWith grateful hearts and joyful spirits,\nwe invite you to an evening of celebration honoring the marriage of\n\nAlfon Lavinski\nSon of Mr. Rudy Susanto Sudjono & Yosefin Paulina Sim\n\nAnd\n\nEugenia Cindy Citrasari\nDaughter of Mr. Hony Surjono & Mrs. Monika Pariva.\n\nüìÖ Saturday, 27 September 2025\nüïñ 19:00 WIB\nüìç Gran Mahakam Hotel, Magnolia Ballroom\n\nMay this night be filled with warmth, laughter, and treasured memories,\nmade even more special by your presence.\n\nKindly confirm your attendance through the link below before ${DUE}:\n${url}\n\nWarm Regards,\n${regardsFor(g.relation, type)}`;
      }
      return msg;
    }

    function regardsFor(rel, type){
      const r = String(rel||'').toLowerCase();
      if(r==='alfon_parent_relation') return `Rudy Susanto Sudjono & Yosefin Paulina Sim\n(the proud parents of the groom)`;
      if(r==='cindy_parent_relation'){
        return type==='holy_matrimony'
          ? `Niketius Hony Surjono & Auxillia Monika Pariva\n(the proud parents of the bride)`
          : `Hony Surjono & Monika Pariva\n(the proud parents of the bride)`;
      }
      if(r==='alfon_relation'||r==='cindy_relation') return 'Alfon & Cindy';
      return 'Alfon & Cindy';
    }
  </script>
</body>
</html>
